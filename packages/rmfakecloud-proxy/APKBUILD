maintainer="Mitchell Scott <mitchell@scottlabs.io>"
pkgname=rmfakecloud-proxy
pkgver=0.0.8
pkgrel=0
pkgdesc="HTTPS proxy for rmfakecloud - redirects reMarkable cloud traffic"
_upstream_author="ddvk"
_category="utilities"
url="https://github.com/ddvk/rmfakecloud-proxy"
arch="aarch64 armv7"
license="MIT"
install="$pkgname.post-install $pkgname.pre-deinstall"
options="!check !fhs !strip !tracedeps"

source="
	installer-rmpro.sh::https://github.com/$_upstream_author/rmfakecloud-proxy/releases/download/v$pkgver/installer-rmpro.sh
	installer-rm12.sh::https://github.com/$_upstream_author/rmfakecloud-proxy/releases/download/v$pkgver/installer-rm12.sh
	LICENSE::https://raw.githubusercontent.com/$_upstream_author/rmfakecloud-proxy/master/LICENSE
"
sha512sums="
6026d9999b048fda36e0ebeaa7556cf8c1e940c9345d80034d82ba2f033a6f9d29d66a715f49a9a4cb65c33dada66f6d7cb24a30ed343ca26106710435dd2288  installer-rmpro.sh
d98efd65d03b4e9ff9935cc86369072378bda642c7d503caee20c2940d2fec5d4f20175b2fa4c5c6e74e4c6eb1efb76e5264883f631a27665a4a35750a975b97  installer-rm12.sh
301894039600f7de8c2dad0be29bc5d0e4f975671a1dd7ce9974731daaa43c83a60f5b7d28bc368423d63e8965f04961800284d0269011a1ae536202ec98ca2e  LICENSE
"

package() {
	case "$CARCH" in
		aarch64)
			install -Dm755 "$srcdir/installer-rmpro.sh" "$pkgdir/home/root/rmfakecloud/install.sh"
			;;
		armv7)
			install -Dm755 "$srcdir/installer-rm12.sh" "$pkgdir/home/root/rmfakecloud/install.sh"
			;;
	esac

	mkdir -p "$pkgdir/home/root/.vellum/licenses/$pkgname"
	install -Dm644 "$srcdir/LICENSE" "$pkgdir/home/root/.vellum/licenses/$pkgname/LICENSE"
	echo "https://github.com/$_upstream_author/rmfakecloud-proxy" > "$pkgdir/home/root/.vellum/licenses/$pkgname/SOURCES"

	install -Dm755 "$startdir/$pkgname.post-os-upgrade" \
		"$pkgdir/home/root/.vellum/hooks/post-os-upgrade/$pkgname"
}
