maintainer="Mitchell Scott <mitchell@scottlabs.io>"
pkgname=rmfakecloud-proxy
pkgver=0.0.9
pkgrel=0
pkgdesc="HTTPS proxy for rmfakecloud - redirects reMarkable cloud traffic"
_upstream_author="ddvk"
_category="utilities"
url="https://github.com/ddvk/rmfakecloud-proxy"
arch="aarch64 armv7"
license="MIT"
install="$pkgname.post-install $pkgname.pre-deinstall"
options="!check !fhs !strip !tracedeps"

source="
	installer-rmpro.sh::https://github.com/$_upstream_author/rmfakecloud-proxy/releases/download/v$pkgver/installer-rmpro.sh
	installer-rm12.sh::https://github.com/$_upstream_author/rmfakecloud-proxy/releases/download/v$pkgver/installer-rm12.sh
	LICENSE::https://raw.githubusercontent.com/$_upstream_author/rmfakecloud-proxy/master/LICENSE
"

package() {
	case "$CARCH" in
		aarch64)
			install -Dm755 "$srcdir/installer-rmpro.sh" "$pkgdir/home/root/rmfakecloud/install.sh"
			;;
		armv7)
			install -Dm755 "$srcdir/installer-rm12.sh" "$pkgdir/home/root/rmfakecloud/install.sh"
			;;
	esac

	mkdir -p "$pkgdir/home/root/.vellum/licenses/$pkgname"
	install -Dm644 "$srcdir/LICENSE" "$pkgdir/home/root/.vellum/licenses/$pkgname/LICENSE"
	echo "https://github.com/$_upstream_author/rmfakecloud-proxy" > "$pkgdir/home/root/.vellum/licenses/$pkgname/SOURCES"

	install -Dm755 "$startdir/$pkgname.post-os-upgrade" \
		"$pkgdir/home/root/.vellum/hooks/post-os-upgrade/$pkgname"
}
sha512sums="
67495e3621ee024e40f6c45bdaf5dffab2360073d73cdc496bf269a7b830615ef79e7b6aad99d481505aed506153602f24a88801f6c264bdcba6ca057e31bfa4  installer-rmpro.sh
04a5be16cd8d385b4ec49260e5bce07a22eaef669300d5b931d8484f06b75fa1c32c8cad3dbea88d44ba508356cf4fcb19e3716886a75e77241d944224438cf6  installer-rm12.sh
301894039600f7de8c2dad0be29bc5d0e4f975671a1dd7ce9974731daaa43c83a60f5b7d28bc368423d63e8965f04961800284d0269011a1ae536202ec98ca2e  LICENSE
"
