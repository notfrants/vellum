maintainer="Mitchell Scott <mitchell@scottlabs.io>"
pkgname=rm-version-switcher
pkgver=0.4.0
pkgrel=0
_upstream_author="rmitchellscott"
_category="utilities"
pkgdesc="Interactive CLI tool for switching between installed reMarkable OS versions"
url="https://github.com/rmitchellscott/rm-version-switcher"
arch="aarch64 armv7"
license="MIT"
options="!check !fhs !strip !tracedeps"

source="
$pkgname-$pkgver-aarch64.tar.gz::https://github.com/rmitchellscott/rm-version-switcher/releases/download/v$pkgver/rm-version-switcher-aarch64.tar.gz
$pkgname-$pkgver-armv7.tar.gz::https://github.com/rmitchellscott/rm-version-switcher/releases/download/v$pkgver/rm-version-switcher-armv7.tar.gz
LICENSE::https://raw.githubusercontent.com/rmitchellscott/rm-version-switcher/main/LICENSE
"

sha512sums="
483528661acf6155ecf3fbd82776a122b3e0a399ff11d1f16434fb8cb3e5f8e3bf89d2f89569e4a1f01c286d7dc2ff8b93b72936a8d12e6b1c87c1133b3229cd  rm-version-switcher-0.4.0-aarch64.tar.gz
dc819f8f99d8c520b849d60174d88bed8e5bba82a5e9f5037be82289cd8ef9e61a02ce1e92fadb2d99346b0523b4ecc7b5b202f0dc650e338b647f8d4db0283c  rm-version-switcher-0.4.0-armv7.tar.gz
b7a86c9fc7a740ff680037b0e6b646ccd70e4e74fef78669b8ba92e18b873e4673fbba064272c595d13bc016288cd4a0532cd974534b7fef43a5b065f24add95  LICENSE
"

prepare() {
	default_prepare
	cd "$srcdir"
	case "$CARCH" in
		aarch64) tar -xzf "$pkgname-$pkgver-aarch64.tar.gz" ;;
		armv7|armhf) tar -xzf "$pkgname-$pkgver-armv7.tar.gz" ;;
	esac
}

package() {
	local bin_file
	case "$CARCH" in
		aarch64)
			bin_file="rm-version-switcher-aarch64"
			;;
		armv7|armhf)
			bin_file="rm-version-switcher-armv7"
			;;
	esac

	install -Dm755 "$srcdir/$bin_file" \
		"$pkgdir/home/root/.vellum/bin/rm-version-switcher"

	mkdir -p "$pkgdir/home/root/.vellum/licenses/$pkgname"
	install -Dm644 "$srcdir/LICENSE" \
		"$pkgdir/home/root/.vellum/licenses/$pkgname/LICENSE"
	echo "https://github.com/rmitchellscott/rm-version-switcher/archive/refs/tags/v$pkgver.tar.gz" > \
		"$pkgdir/home/root/.vellum/licenses/$pkgname/SOURCES"
}
